<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>âœ‚ï¸ ä»£ç æ‹†åˆ†(Code Splitting)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link type="text/css" rel="stylesheet" href="assets/style.css" />
  <link type="text/css" rel="stylesheet" href="assets/pilcrow.css" />
  <link type="text/css" rel="stylesheet" href="assets/hljs-github.min.css"/>
  <!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110647385-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110647385-1');
  </script>-->
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6b5f065a80e0af3ff54139cf0ae94d47";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>    
</head>
<body>
  <header>
    <a class="logo" href="/">
      <img class="parcel" src="assets/parcel.png" srcset="assets/parcel@2x.png 2x, assets/parcel@3x.png 3x" height="30">
      <img class="type" src="assets/logo.svg" alt="Parcel">
    </a>
    <div class="links">
      <a href="https://github.com/parcel-bundler/parcel" target="_blank">GitHub</a>
    </div>
  </header>
  <div class="content">
    <nav>
      <ul>
        <li><a href="getting_started.html">ğŸš€ å¿«é€Ÿå¼€å§‹</a></li>
        <li><a href="assets.html">ğŸ“¦ èµ„æº</a></li>
        <li><a href="transforms.html">ğŸ  è½¬æ¢</a></li>
        <li><a href="code_splitting.html">âœ‚ï¸ ä»£ç æ‹†åˆ†</a></li>
        <li><a href="hmr.html">ğŸ”¥ çƒ­æ¨¡å—é‡è½½</a></li>
        <li><a href="production.html">âœ¨ ç”Ÿäº§ç¯å¢ƒ</a></li>
        <li><a href="recipes.html">ğŸ° é…æ–¹</a></li>
      </ul>
      <h3>è¿›é˜¶</h3>
      <ul>
        <li><a href="how_it_works.html">ğŸ›  å®ƒå¦‚ä½•è¿ä½œ</a></li>
        <li><a href="asset_types.html">ğŸ“ èµ„æºç±»å‹</a></li>
        <li><a href="packagers.html">ğŸ“¦ Packagers</a></li>
        <li><a href="plugins.html">ğŸ”Œ æ’ä»¶</a></li>
      </ul>
    </nav>
    <main><h1 id="âœ‚ï¸-ä»£ç æ‹†åˆ†(code-splitting)"><a class="header-link" href="#âœ‚ï¸-ä»£ç æ‹†åˆ†(code-splitting)"></a>âœ‚ï¸ ä»£ç æ‹†åˆ†(Code Splitting)</h1>
<p>Parcel æ”¯æŒé›¶é…ç½®ä»£ç æ‹†åˆ†ï¼Œå¹¶ä¸”å¼€ç®±å³ç”¨ã€‚è¿™å…è®¸æ‚¨å°†åº”ç”¨ç¨‹åºçš„ä»£ç æ‹†åˆ†æˆå•ç‹¬çš„åŒ…ï¼Œè¿™äº›åŒ…å¯ä»¥æŒ‰éœ€åŠ è½½ï¼Œè¿™æ„å‘³ç€æ›´å°çš„åˆå§‹åŒ…å¤§å°å’Œæ›´çŸ­çš„åŠ è½½æ—¶é—´ã€‚éšç€ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­æµè§ˆç›¸åº”çš„æ¨¡å—éœ€è¦åŠ è½½ï¼ŒParcel ä¼šè‡ªåŠ¨è´Ÿè´£æŒ‰éœ€åŠ è½½å­æ†ç»‘åŒ…ã€‚</p>
<p>ä»£ç æ‹†åˆ†æ—¶é€šè¿‡ä½¿ç”¨åŠ¨æ€ <code>import()</code> å‡½æ•°çš„<a href="https://github.com/tc39/proposal-dynamic-import">è¯­æ³•ææ¡ˆ</a>æ¥æ§åˆ¶çš„ï¼Œè¯¥ææ¡ˆä¸æ™®é€š <code>import</code> è¯­å¥æˆ– <code>require</code> å‡½æ•°çš„ç±»ä¼¼ï¼Œä½†è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚è¿™æ„å‘³ç€æ¨¡å—æ˜¯å¼‚æ­¥åŠ è½½çš„ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨åŠ¨æ€å¯¼å…¥(dynamic import)æ¥æŒ‰éœ€åŠ è½½åº”ç”¨ç¨‹åºçš„å­é¡µé¢ã€‚</p>
<pre class="hljs"><code><span class="hljs-comment">// pages/about.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// æ¸²æŸ“é¡µé¢</span>
}</code></pre><pre class="hljs"><code><span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">page</span>) </span>{
  <span class="hljs-comment">// æ¸²æŸ“é¡µé¢</span>
  page.render();
});</code></pre><p>å› ä¸º <code>import()</code> è¿”å›ä¸€ä¸ªPromiseï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ async/await è¯­æ³•ã€‚ä¸è¿‡ï¼Œåœ¨æµè§ˆå™¨å¹¿æ³›æ”¯æŒå®ƒä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦é…ç½® Babel æ¥è½¬æ¢è¯­æ³•ã€‚</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>);
<span class="hljs-comment">// æ¸²æŸ“é¡µé¢</span>
page.render();</code></pre><p>åŠ¨æ€å¯¼å…¥ä¹Ÿä¼šåœ¨ Parcel ä¸­å»¶è¿ŸåŠ è½½ï¼Œå› æ­¤ä½ ä»ç„¶éœ€è¦å°†æ‰€æœ‰çš„ <code>import()</code> è°ƒç”¨æ”¾åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å­æ†ç»‘åŒ…ä¹‹å‰ï¼Œå®ƒä»¬ä¸ä¼šè¢«åŠ è½½ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åŠ¨æ€åœ°å»¶è¿ŸåŠ è½½åº”ç”¨ç¨‹åºçš„å­é¡µé¢ã€‚</p>
<pre class="hljs"><code><span class="hljs-comment">// è®¾ç½®é¡µé¢åç§°åˆ°åŠ¨æ€å¼•å…¥çš„æ˜ å°„ä¸­ã€‚</span>
<span class="hljs-comment">// åœ¨ä½¿ç”¨å‰ï¼Œè¿™äº›é¡µé¢éƒ½ä¸ä¼šè¢«åŠ è½½ã€‚</span>
<span class="hljs-keyword">const</span> pages = {
  <span class="hljs-attr">about</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>),
  <span class="hljs-attr">blog</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/blog'</span>)
};

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderPage</span>(<span class="hljs-params">page</span>) </span>{
  <span class="hljs-comment">// æ‡’åŠ è½½è¯·æ±‚é¡µé¢ã€‚</span>
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> pages[page];
  <span class="hljs-keyword">return</span> page.render();
}</code></pre><p><strong>æ³¨æ„ï¼š</strong> å¦‚æœä½ ä»ç„¶æƒ³åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ä½¿ç”¨ä¸æ”¯æŒçš„è¯­æ³• async/await ï¼Œåˆ‡è®°éœ€è¦åœ¨ä½ çš„åº”ç”¨ç¨‹åºå¼•å…¥ <code>babel-polyfill</code> æˆ–åœ¨ä½ çš„åº“ä¸­å¼•å…¥ <code>babel-runtime</code> + <code>babel-plugin-transform-runtime</code> ã€‚</p>
<pre class="hljs"><code>yarn add babel-polyfill</code></pre><pre class="hljs"><code><span class="hljs-keyword">import</span> <span class="hljs-string">"babel-polyfill"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"./app"</span>;</code></pre><p>è¯·å‚é˜… <a href="http://babeljs.cn/docs/usage/polyfill">babel-polyfill</a> å’Œ <a href="http://babeljs.cn/docs/plugins/transform-runtime">babel-runtime</a> çš„æ–‡æ¡£ã€‚</p>
    </main>
  </div>
  <script>
    (function () {
      var activeLink = Array.from(document.querySelectorAll('nav a')).find(function (a) {
        return a.href === window.location.href;
      });

      activeLink.classList.add('selected');
    })();
  </script>
</body>
</html>
