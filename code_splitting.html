<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>✂️ 代码拆分(Code Splitting)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link type="text/css" rel="stylesheet" href="assets/style.css" />
  <link type="text/css" rel="stylesheet" href="assets/pilcrow.css" />
  <link type="text/css" rel="stylesheet" href="assets/hljs-github.min.css"/>
  <!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110647385-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110647385-1');
  </script>-->
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6b5f065a80e0af3ff54139cf0ae94d47";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>    
</head>
<body>
  <header>
    <a class="logo" href="/">
      <img class="parcel" src="assets/parcel.png" srcset="assets/parcel@2x.png 2x, assets/parcel@3x.png 3x" height="30">
      <img class="type" src="assets/logo.svg" alt="Parcel">
    </a>
    <div class="links">
      <a href="https://github.com/parcel-bundler/parcel" target="_blank">GitHub</a>
    </div>
  </header>
  <div class="content">
    <nav>
      <ul>
        <li><a href="getting_started.html">🚀 快速开始</a></li>
        <li><a href="assets.html">📦 资源</a></li>
        <li><a href="transforms.html">🐠 转换</a></li>
        <li><a href="code_splitting.html">✂️ 代码拆分</a></li>
        <li><a href="hmr.html">🔥 热模块重载</a></li>
        <li><a href="production.html">✨ 生产环境</a></li>
        <li><a href="recipes.html">🍰 配方</a></li>
      </ul>
      <h3>进阶</h3>
      <ul>
        <li><a href="how_it_works.html">🛠 它如何运作</a></li>
        <li><a href="asset_types.html">📝 资源类型</a></li>
        <li><a href="packagers.html">📦 Packagers</a></li>
        <li><a href="plugins.html">🔌 插件</a></li>
      </ul>
    </nav>
    <main><h1 id="✂️-代码拆分(code-splitting)"><a class="header-link" href="#✂️-代码拆分(code-splitting)"></a>✂️ 代码拆分(Code Splitting)</h1>
<p>Parcel 支持零配置代码拆分，并且开箱即用。这允许您将应用程序的代码拆分成单独的包，这些包可以按需加载，这意味着更小的初始包大小和更短的加载时间。随着用户在应用程序中浏览相应的模块需要加载，Parcel 会自动负责按需加载子捆绑包。</p>
<p>代码拆分时通过使用动态 <code>import()</code> 函数的<a href="https://github.com/tc39/proposal-dynamic-import">语法提案</a>来控制的，该提案与普通 <code>import</code> 语句或 <code>require</code> 函数的类似，但返回一个 Promise 对象。这意味着模块是异步加载的。</p>
<p>以下示例展示了如何使用动态导入(dynamic import)来按需加载应用程序的子页面。</p>
<pre class="hljs"><code><span class="hljs-comment">// pages/about.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// 渲染页面</span>
}</code></pre><pre class="hljs"><code><span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">page</span>) </span>{
  <span class="hljs-comment">// 渲染页面</span>
  page.render();
});</code></pre><p>因为 <code>import()</code> 返回一个Promise，所以你也可以使用 async/await 语法。不过，在浏览器广泛支持它之前，你可能需要配置 Babel 来转换语法。</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>);
<span class="hljs-comment">// 渲染页面</span>
page.render();</code></pre><p>动态导入也会在 Parcel 中延迟加载，因此你仍然需要将所有的 <code>import()</code> 调用放在文件的顶部，并且在使用子捆绑包之前，它们不会被加载。以下示例展示如何动态地延迟加载应用程序的子页面。</p>
<pre class="hljs"><code><span class="hljs-comment">// 设置页面名称到动态引入的映射中。</span>
<span class="hljs-comment">// 在使用前，这些页面都不会被加载。</span>
<span class="hljs-keyword">const</span> pages = {
  <span class="hljs-attr">about</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/about'</span>),
  <span class="hljs-attr">blog</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/blog'</span>)
};

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderPage</span>(<span class="hljs-params">page</span>) </span>{
  <span class="hljs-comment">// 懒加载请求页面。</span>
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> pages[page];
  <span class="hljs-keyword">return</span> page.render();
}</code></pre><p><strong>注意：</strong> 如果你仍然想在本地浏览器中使用不支持的语法 async/await ，切记需要在你的应用程序引入 <code>babel-polyfill</code> 或在你的库中引入 <code>babel-runtime</code> + <code>babel-plugin-transform-runtime</code> 。</p>
<pre class="hljs"><code>yarn add babel-polyfill</code></pre><pre class="hljs"><code><span class="hljs-keyword">import</span> <span class="hljs-string">"babel-polyfill"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"./app"</span>;</code></pre><p>请参阅 <a href="http://babeljs.cn/docs/usage/polyfill">babel-polyfill</a> 和 <a href="http://babeljs.cn/docs/plugins/transform-runtime">babel-runtime</a> 的文档。</p>
    </main>
  </div>
  <script>
    (function () {
      var activeLink = Array.from(document.querySelectorAll('nav a')).find(function (a) {
        return a.href === window.location.href;
      });

      activeLink.classList.add('selected');
    })();
  </script>
</body>
</html>
