<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>📝 资源类型</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link type="text/css" rel="stylesheet" href="assets/style.css" />
  <link type="text/css" rel="stylesheet" href="assets/pilcrow.css" />
  <link type="text/css" rel="stylesheet" href="assets/hljs-github.min.css"/>
  <!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110647385-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110647385-1');
  </script>-->
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6b5f065a80e0af3ff54139cf0ae94d47";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>    
</head>
<body>
  <header>
    <a class="logo" href="/">
      <img class="parcel" src="assets/parcel.png" srcset="assets/parcel@2x.png 2x, assets/parcel@3x.png 3x" height="30">
      <img class="type" src="assets/logo.svg" alt="Parcel">
    </a>
    <div class="links">
      <a href="https://github.com/parcel-bundler/parcel" target="_blank">GitHub</a>
    </div>
  </header>
  <div class="content">
    <nav>
      <ul>
        <li><a href="getting_started.html">🚀 快速开始</a></li>
        <li><a href="assets.html">📦 资源</a></li>
        <li><a href="transforms.html">🐠 转换</a></li>
        <li><a href="code_splitting.html">✂️ 代码拆分</a></li>
        <li><a href="hmr.html">🔥 热模块替换</a></li>
        <li><a href="production.html">✨ 生产环境</a></li>
      </ul>
      <h3>进阶</h3>
      <ul>
        <li><a href="how_it_works.html">🛠 它如何运作</a></li>
        <li><a href="asset_types.html">📝 资源类型</a></li>
        <li><a href="packagers.html">📦 Packagers</a></li>
        <li><a href="plugins.html">🔌 插件</a></li>
      </ul>
    </nav>
    <main><h1 id="📝-资源类型"><a class="header-link" href="#📝-资源类型"></a>📝 资源类型</h1>
<p>正如 <a href="assets.html">资源文档</a> 里描述的，Parcel 将输入的文件看作 <code>资源（Asset）</code>。资源类型被看作继承自基准 <code>Asset</code>类的子类，并实现了必须的接口，去解析、分析依赖、转换及生成代码。</p>
<p>因为 Parcel 在多处理器内核中并行处理资源，因此资源类型所能够实施的转换行为，会被限制为那些可以在单一时间内操作单一文件的转换行为。而那些需要操作多个文件的转换行为，则需要一个自定义的<a href="packagers.html">Packager</a>。</p>
<h2 id="资源接口"><a class="header-link" href="#资源接口"></a>资源接口</h2>
<pre class="hljs"><code><span class="hljs-keyword">const</span> {Asset} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'parcel-bundler'</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAsset</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Asset</span> </span>{
  type = <span class="hljs-string">'foo'</span>; <span class="hljs-comment">// 设置主要输出类型</span>

  parse(code) {
    <span class="hljs-comment">// 将代码解析为AST树</span>
    <span class="hljs-keyword">return</span> ast;
  }

  pretransform() {
    <span class="hljs-comment">// 可选。在收集依赖之前转换。</span>
  }

  collectDependencies() {
    <span class="hljs-comment">// 分析依赖</span>
    <span class="hljs-keyword">this</span>.addDependency(<span class="hljs-string">'my-dep'</span>);
  }

  transform() {
    <span class="hljs-comment">// 可选。在收集依赖之后转换。</span>
  }

  generate() {
    <span class="hljs-comment">// 生成做对。如有需要，可返回多个转换(renditions)。</span>
    <span class="hljs-comment">// 结果会传到合适的 packagers 去生成最终的文件束</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">foo</span>: <span class="hljs-string">'my stuff here'</span>, <span class="hljs-comment">// 主输出</span>
      js: <span class="hljs-string">'some javascript'</span> <span class="hljs-comment">// 如若需要，此转换内容可被放到 JS 文件束中</span>
    };
  }
}</code></pre><h2 id="注册资源类型"><a class="header-link" href="#注册资源类型"></a>注册资源类型</h2>
<p>你可以用 <code>addAssetType</code> 方法在打包工具中去注册你的资源类型。它接受一个文件扩展名，以及资源类型模块的路径。它是一个路径，而非实际的对象，这样可以使它被传至 worker 进程中。</p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> Bundler = <span class="hljs-built_in">require</span>(<span class="hljs-string">'parcel-bundler'</span>);

<span class="hljs-keyword">let</span> bundler = <span class="hljs-keyword">new</span> Bundler(<span class="hljs-string">'input.js'</span>);
bundler.addAssetType(<span class="hljs-string">'.ext'</span>, <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'./MyAsset'</span>));</code></pre>    </main>
  </div>
  <script>
    (function () {
      var activeLink = Array.from(document.querySelectorAll('nav a')).find(function (a) {
        return a.href === window.location.href;
      });

      activeLink.classList.add('selected');
    })();
  </script>
</body>
</html>
